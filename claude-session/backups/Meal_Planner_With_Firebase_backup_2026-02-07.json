[{"id":"YlJiEytLm1232fXM","name":"Meal Planner (With Firebase)","active":1,"nodes":"[{\"parameters\":{\"authentication\":\"serviceAccount\",\"documentId\":{\"__rl\":true,\"value\":\"1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w\",\"mode\":\"list\",\"cachedResultName\":\"Meal Planning Data\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit?usp=drivesdk\"},\"sheetName\":{\"__rl\":true,\"value\":\"gid=0\",\"mode\":\"list\",\"cachedResultName\":\"Favorite Meals\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit#gid=0\"},\"options\":{}},\"id\":\"fcf2a4f8-d2df-42bf-8580-c24e707f4dfd\",\"name\":\"Read Favorite Meals\",\"type\":\"n8n-nodes-base.googleSheets\",\"typeVersion\":4,\"position\":[-288,-16],\"credentials\":{\"googleApi\":{\"id\":\"n1rhMvRIp4MBbbbS\",\"name\":\"Google Service Account account\"}}},{\"parameters\":{\"authentication\":\"serviceAccount\",\"documentId\":{\"__rl\":true,\"value\":\"1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w\",\"mode\":\"list\",\"cachedResultName\":\"Meal Planning Data\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit?usp=drivesdk\"},\"sheetName\":{\"__rl\":true,\"value\":1629510590,\"mode\":\"list\",\"cachedResultName\":\"Preferences\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit#gid=1629510590\"},\"options\":{}},\"id\":\"3b1ffced-e635-4e64-8a1f-2a6b9c037c74\",\"name\":\"Read Preferences\",\"type\":\"n8n-nodes-base.googleSheets\",\"typeVersion\":4,\"position\":[-288,112],\"credentials\":{\"googleApi\":{\"id\":\"n1rhMvRIp4MBbbbS\",\"name\":\"Google Service Account account\"}}},{\"parameters\":{\"authentication\":\"serviceAccount\",\"documentId\":{\"__rl\":true,\"value\":\"1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w\",\"mode\":\"list\",\"cachedResultName\":\"Meal Planning Data\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit?usp=drivesdk\"},\"sheetName\":{\"__rl\":true,\"value\":1411491712,\"mode\":\"list\",\"cachedResultName\":\"Food Goals\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit#gid=1411491712\"},\"options\":{}},\"id\":\"460cbec7-1518-40d7-9f36-f5d4249de227\",\"name\":\"Read Food Goals\",\"type\":\"n8n-nodes-base.googleSheets\",\"typeVersion\":4,\"position\":[-288,224],\"credentials\":{\"googleApi\":{\"id\":\"n1rhMvRIp4MBbbbS\",\"name\":\"Google Service Account account\"}}},{\"parameters\":{\"authentication\":\"serviceAccount\",\"documentId\":{\"__rl\":true,\"value\":\"1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w\",\"mode\":\"list\",\"cachedResultName\":\"Meal Planning Data\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit?usp=drivesdk\"},\"sheetName\":{\"__rl\":true,\"value\":1904280104,\"mode\":\"list\",\"cachedResultName\":\"Pantry Items\",\"cachedResultUrl\":\"https://docs.google.com/spreadsheets/d/1Vjd_jXX31GFPtddHitbGBh_jlIDsTy6pYvtlopcbc0w/edit#gid=1904280104\"},\"options\":{}},\"id\":\"51509fa1-d8c8-4959-bd93-03a190f7e00d\",\"name\":\"Read Pantry Items\",\"type\":\"n8n-nodes-base.googleSheets\",\"typeVersion\":4,\"position\":[-288,352],\"credentials\":{\"googleApi\":{\"id\":\"n1rhMvRIp4MBbbbS\",\"name\":\"Google Service Account account\"}}},{\"parameters\":{\"jsCode\":\"const allItems = $input.all();\\n\\n// Extract data by column (each column represents one sheet)\\nfunction extractColumn(items, columnIndex) {\\n  const values = [];\\n  \\n  for (const item of items) {\\n    const keys = Object.keys(item.json).filter(k => k !== 'row_number');\\n    if (keys[columnIndex]) {\\n      const value = item.json[keys[columnIndex]];\\n      if (value && value.trim() !== '') {\\n        values.push(value);\\n      }\\n    }\\n  }\\n  \\n  return values;\\n}\\n\\n// Column 0 = Favorite Meals, 1 = Preferences, 2 = Goals, 3 = Pantry\\nconst favoriteMeals = extractColumn(allItems, 0);\\nconst userPreferences = extractColumn(allItems, 1);\\nconst foodGoals = extractColumn(allItems, 2);\\nconst pantryItems = extractColumn(allItems, 3);\\n\\nreturn {\\n  json: {\\n    favoriteMeals,\\n    userPreferences,\\n    foodGoals,\\n    pantryItems\\n  }\\n};\"},\"id\":\"0f19036c-e1e0-4807-acdd-bada391c96e1\",\"name\":\"Combine Sheet Data\",\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[240,192]},{\"parameters\":{\"jsCode\":\"const data = $input.first().json;\\nconst randomSeed = Math.random().toString(36).substring(7);\\n\\nconst prompt = `You are a helpful meal planning assistant. Generate 5 VARIED and DIVERSE weeknight dinner meals (Monday through Friday).\\n\\n**CRITICAL VARIETY REQUIREMENTS:**\\n- Use DIFFERENT proteins each day: Mix chicken, fish, beef, vegetarian, pork, shrimp across the week\\n- Vary cooking methods: pan-seared, baked, grilled, one-pot, sheet pan, slow cooker, stir-fry\\n- Vary cuisines: Mexican, Italian, Asian, American, Mediterranean, Indian - don't repeat cuisines\\n- RANDOMIZE which favorites you select - do NOT always use the same meals\\n- Do NOT assign meals to specific days based on patterns (like \\\"always chicken on Monday\\\")\\n- Shuffle the order - if you suggested Tacos on Wednesday last time, put them on Friday this time\\n- Be creative and mix it up each time you generate meals\\n\\n**Random seed for variety:** ${randomSeed}\\n\\n**Favorite Meals (pick DIFFERENT ones each time):**\\n${data.favoriteMeals.join('\\\\n')}\\n\\n**User Preferences:**\\n${data.userPreferences.join('\\\\n')}\\n\\n**Food Goals:**\\n${data.foodGoals.join('\\\\n')}\\n\\n**Pantry Items (exclude from shopping list):**\\n${data.pantryItems.join('\\\\n')}\\n\\n**Requirements:**\\n1. Generate exactly 5 meals (one for each weeknight: Monday, Tuesday, Wednesday, Thursday, Friday)\\n2. Each meal should include:\\n   - name: Clear, descriptive meal name\\n   - recipe: Step-by-step cooking instructions (numbered steps)\\n   - source: Recipe source (prefer Budget Bytes or Skinnytaste when possible)\\n   - url: Link to the recipe online\\n   - prepTime: Estimated prep + cook time (e.g., \\\"30 min\\\")\\n   - ingredients: Array of all ingredients needed (with quantities)\\n3. MUST vary protein types across all 5 days - no repeating chicken, beef, etc.\\n4. Keep meals to 30 minutes or less when possible\\n5. Make meals family-friendly and kid-approved\\n6. Use seasonal ingredients when appropriate\\n7. Mix easy and moderate difficulty meals throughout the week\\n\\n**CRITICAL:** Respond ONLY with valid JSON in this exact format. No markdown, no explanation, just the JSON:\\n\\n\\\\`\\\\`\\\\`json\\n{\\n  \\\"Monday\\\": {\\n    \\\"name\\\": \\\"Chicken Tacos\\\",\\n    \\\"recipe\\\": \\\"1. Heat tortillas...\\\\\\\\n2. Cook chicken...\\\",\\n    \\\"source\\\": \\\"Budget Bytes\\\",\\n    \\\"url\\\": \\\"https://budgetbytes.com/chicken-tacos\\\",\\n    \\\"prepTime\\\": \\\"25 min\\\",\\n    \\\"ingredients\\\": [\\\"1 lb chicken breast\\\", \\\"8 tortillas\\\", ...]\\n  },\\n  \\\"Tuesday\\\": { ... },\\n  \\\"Wednesday\\\": { ... },\\n  \\\"Thursday\\\": { ... },\\n  \\\"Friday\\\": { ... }\\n}\\n\\\\`\\\\`\\\\`\\n\\nGenerate 5 DIVERSE meals now:`;\\n\\nreturn {\\n  json: {\\n    model: \\\"claude-sonnet-4-20250514\\\",\\n    max_tokens: 4000,\\n    messages: [\\n      {\\n        role: \\\"user\\\",\\n        content: prompt\\n      }\\n    ]\\n  }\\n};\"},\"id\":\"d4cd1075-8a12-417f-9580-36d7919da346\",\"name\":\"Build Claude Prompt\",\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[448,192]},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://api.anthropic.com/v1/messages\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpHeaderAuth\",\"sendHeaders\":true,\"headerParameters\":{\"parameters\":[{\"name\":\"anthropic-version\",\"value\":\"2023-06-01\"},{\"name\":\"content-type\",\"value\":\"application/json\"}]},\"sendBody\":true,\"specifyBody\":\"json\",\"jsonBody\":\"={{ JSON.stringify({\\n  model: $json.model,\\n  max_tokens: $json.max_tokens,\\n  messages: $json.messages\\n}) }}\",\"options\":{}},\"id\":\"0f89ed38-7fbb-4f43-bb0f-1441001c4f2e\",\"name\":\"Claude API\",\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[672,192],\"credentials\":{\"httpHeaderAuth\":{\"id\":\"bM9dixgG7bvmZiRg\",\"name\":\"Claude Header Auth\"}}},{\"parameters\":{\"jsCode\":\"const response = $input.first().json;\\n\\nlet text = '';\\nif (response.content && Array.isArray(response.content)) {\\n  text = response.content\\n    .filter(block => block.type === 'text')\\n    .map(block => block.text)\\n    .join('');\\n}\\n\\ntext = text.replace(/```json\\\\n?/g, '').replace(/```\\\\n?/g, '').trim();\\n\\nlet meals;\\ntry {\\n  meals = JSON.parse(text);\\n} catch (error) {\\n  throw new Error(`Failed to parse Claude response as JSON: ${error.message}\\\\n\\\\nResponse text: ${text}`);\\n}\\n\\nconst requiredDays = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];\\nfor (const day of requiredDays) {\\n  if (!meals[day]) {\\n    throw new Error(`Missing meal for ${day}`);\\n  }\\n  const meal = meals[day];\\n  if (!meal.name || !meal.recipe || !meal.ingredients) {\\n    throw new Error(`Invalid meal structure for ${day}`);\\n  }\\n}\\n\\nreturn {\\n  json: {\\n    meals,\\n    generatedAt: new Date().toISOString()\\n  }\\n};\"},\"id\":\"0acca4e4-0866-4ac4-9318-b5f9a1700d00\",\"name\":\"Parse Claude Response\",\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[880,192]},{\"parameters\":{\"jsCode\":\"// Prepare meals for Firebase - add status \\\"pending\\\" to each\\nconst { meals } = $input.first().json;\\n\\nconst days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];\\nconst firebaseMeals = {};\\n\\nfor (const day of days) {\\n  firebaseMeals[day] = {\\n    ...meals[day],\\n    status: 'pending'\\n  };\\n}\\n\\nreturn {\\n  json: {\\n    meals: firebaseMeals\\n  }\\n};\"},\"id\":\"9fef0ebd-eb81-472e-934a-fb4567afa84d\",\"name\":\"Prepare Firebase Data\",\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[1104,192]},{\"parameters\":{\"method\":\"PUT\",\"url\":\"https://family-hub-dashboard-default-rtdb.firebaseio.com/meals.json\",\"authentication\":\"genericCredentialType\",\"genericAuthType\":\"httpQueryAuth\",\"sendBody\":true,\"specifyBody\":\"json\",\"jsonBody\":\"={{ JSON.stringify($json.meals) }}\",\"options\":{}},\"id\":\"b1d313fc-e125-4b97-91c2-71f8f80c0638\",\"name\":\"Save to Firebase\",\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[1328,192],\"credentials\":{\"httpQueryAuth\":{\"id\":\"jOtWdsKTauV30mbJ\",\"name\":\"Firebase Database Secret\"}}},{\"parameters\":{\"jsCode\":\"const { meals } = $('Prepare Firebase Data').first().json;\\n\\nconst days = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];\\n\\nconst blocks = [\\n  {\\n    type: 'header',\\n    text: {\\n      type: 'plain_text',\\n      text: 'üçΩÔ∏è This Week\\\\'s Dinner Menu',\\n      emoji: true\\n    }\\n  },\\n  {\\n    type: 'section',\\n    text: {\\n      type: 'mrkdwn',\\n      text: 'Here are your meals for this week. Approve or reject each one:'\\n    }\\n  },\\n  {\\n    type: 'divider'\\n  }\\n];\\n\\nfor (const day of days) {\\n  const meal = meals[day];\\n  \\n  blocks.push({\\n    type: 'section',\\n    text: {\\n      type: 'mrkdwn',\\n      text: `*${day}:* ${meal.name}\\\\n_${meal.prepTime} ‚Ä¢ ${meal.source}_`\\n    },\\n    accessory: {\\n      type: 'button',\\n      text: {\\n        type: 'plain_text',\\n        text: '‚úì Approve',\\n        emoji: true\\n      },\\n      value: day,\\n      action_id: `meal_approve_${day}`\\n    }\\n  });\\n  \\n  blocks.push({\\n    type: 'actions',\\n    elements: [\\n      {\\n        type: 'button',\\n        text: {\\n          type: 'plain_text',\\n          text: '‚úó Reject',\\n          emoji: true\\n        },\\n        value: day,\\n        action_id: `meal_reject_${day}`,\\n        style: 'danger'\\n      }\\n    ]\\n  });\\n}\\n\\nblocks.push(\\n  {\\n    type: 'divider'\\n  },\\n  {\\n    type: 'actions',\\n    elements: [\\n      {\\n        type: 'button',\\n        text: {\\n          type: 'plain_text',\\n          text: '‚úì Approve All 5 Meals',\\n          emoji: true\\n        },\\n        value: 'approve_all',\\n        action_id: 'meal_approve_all',\\n        style: 'primary'\\n      }\\n    ]\\n  }\\n);\\n\\nreturn {\\n  json: {\\n    blocks,\\n    text: 'This week\\\\'s dinner menu is ready for review!'\\n  }\\n};\"},\"id\":\"92645f28-a55e-4a8f-875e-3faca1d8158a\",\"name\":\"Build Slack Message\",\"type\":\"n8n-nodes-base.code\",\"typeVersion\":2,\"position\":[1552,192]},{\"parameters\":{\"method\":\"POST\",\"url\":\"https://hooks.slack.com/services/REDACTED\",\"sendBody\":true,\"specifyBody\":\"json\",\"jsonBody\":\"={{ JSON.stringify({\\n  blocks: $json.blocks,\\n  text: $json.text\\n}) }}\",\"options\":{}},\"id\":\"230bd025-6a32-4f76-88af-c6e131b61ce4\",\"name\":\"Post to Slack\",\"type\":\"n8n-nodes-base.httpRequest\",\"typeVersion\":4.2,\"position\":[1760,192]},{\"parameters\":{\"mode\":\"combine\",\"combineBy\":\"combineByPosition\",\"numberInputs\":4,\"options\":{}},\"type\":\"n8n-nodes-base.merge\",\"typeVersion\":3.2,\"position\":[48,160],\"id\":\"51891344-a79c-4ca0-bf27-af6372fee382\",\"name\":\"Merge\"},{\"parameters\":{\"rule\":{\"interval\":[{\"field\":\"weeks\",\"triggerAtHour\":10}]}},\"type\":\"n8n-nodes-base.scheduleTrigger\",\"typeVersion\":1.2,\"position\":[-752,176],\"id\":\"d73b7be4-8ddd-41d5-a4d4-c1a1e3326ff7\",\"name\":\"Schedule Trigger\"}]","connections":"{\"Read Favorite Meals\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":0}]]},\"Combine Sheet Data\":{\"main\":[[{\"node\":\"Build Claude Prompt\",\"type\":\"main\",\"index\":0}]]},\"Build Claude Prompt\":{\"main\":[[{\"node\":\"Claude API\",\"type\":\"main\",\"index\":0}]]},\"Claude API\":{\"main\":[[{\"node\":\"Parse Claude Response\",\"type\":\"main\",\"index\":0}]]},\"Parse Claude Response\":{\"main\":[[{\"node\":\"Prepare Firebase Data\",\"type\":\"main\",\"index\":0}]]},\"Prepare Firebase Data\":{\"main\":[[{\"node\":\"Save to Firebase\",\"type\":\"main\",\"index\":0}]]},\"Save to Firebase\":{\"main\":[[{\"node\":\"Build Slack Message\",\"type\":\"main\",\"index\":0}]]},\"Build Slack Message\":{\"main\":[[{\"node\":\"Post to Slack\",\"type\":\"main\",\"index\":0}]]},\"Read Food Goals\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":2}]]},\"Read Pantry Items\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":3}]]},\"Read Preferences\":{\"main\":[[{\"node\":\"Merge\",\"type\":\"main\",\"index\":1}]]},\"Merge\":{\"main\":[[{\"node\":\"Combine Sheet Data\",\"type\":\"main\",\"index\":0}]]},\"Schedule Trigger\":{\"main\":[[{\"node\":\"Read Favorite Meals\",\"type\":\"main\",\"index\":0},{\"node\":\"Read Preferences\",\"type\":\"main\",\"index\":0},{\"node\":\"Read Food Goals\",\"type\":\"main\",\"index\":0},{\"node\":\"Read Pantry Items\",\"type\":\"main\",\"index\":0}]]}}","settings":"{\"executionOrder\":\"v1\"}","staticData":"{\"node:Schedule Trigger\":{\"recurrenceRules\":[]}}"}]
