# Criterion 4 Work Plan: Full Crew with Slack Output

**Session:** 2026-02-01-c
**Created:** 2026-02-01 23:15 PST
**Governing Roadmap:** CrewAI-Strategic-Intelligence-Crew.md

---

## Current State Assessment

### What's Working (Criteria 1-3 Complete)
- ‚úÖ Container 118 operational at 192.168.1.18
- ‚úÖ Python 3.11.2 + CrewAI 1.9.3 installed
- ‚úÖ Scout agent (Haiku) + Analyst agent (Sonnet 4.5) operational
- ‚úÖ RSS source fetcher working (5 sources configured)
- ‚úÖ Context management via Slack (5 commands: `/interests`, `/newproject`, `/updatebrief`, `/transcript`, `/recall`)
- ‚úÖ n8n workflow "Context Manager" deployed
- ‚úÖ Manual crew execution: `python3 /opt/crewai/crew.py` produces digest files

### What's Missing (Criterion 4 Scope)
- ‚ùå Homelab Strategist agent
- ‚ùå Work Strategist agent
- ‚ùå Context file integration (agents don't read `/context/` files yet)
- ‚ùå Slack output delivery (currently saves to local file)
- ‚ùå n8n scheduled trigger (daily execution)
- ‚ùå Proper digest formatting for Slack (markdown with threading support)

---

## Criterion 4 Requirements (from Roadmap)

**Primary Outcome:**
All 5 agents operational. Daily n8n-triggered run. Output delivered to Slack `#trend-monitoring`. Strategists evaluate against Kyle's context files.

**Evidence Required:**
- n8n scheduled workflow triggers crew daily
- Slack receives digest message
- Strategists reference content from `/context/` files
- Opportunities flagged when relevant to homelab or work context

**Non-Goals:**
- No approval flow yet (Criterion 5)
- No Catalyst deliverables yet (Criterion 5)

---

## Implementation Plan

### Phase 1: Add Homelab Strategist Agent (60-90 min)

**Goal:** Create Homelab Strategist agent that evaluates Scout/Analyst output against homelab context.

**Concrete Artifacts:**
1. Enhanced `crew.py` with Homelab Strategist agent definition
2. Homelab Strategist task definition
3. Context loader utility (`tools/context_loader.py`)
4. Updated execution flow (sequential: Scout ‚Üí Analyst ‚Üí Homelab Strategist)
5. Test output demonstrating Homelab Strategist evaluation

**Context Files Read:**
- `/context/homelab_architecture.md` (currently empty - may need to populate)
- `/context/interest_areas.md` (currently empty - may need to populate)

**Agent Specification:**
- **Model:** Sonnet 4.5 (consistency with Analyst)
- **Role:** "Homelab Strategist"
- **Goal:** "Evaluate trend signals for relevance to Kyle's homelab projects and learning goals"
- **Input:** Analyst synthesis + homelab context files
- **Output:** Opportunity list with homelab relevance scores and specific connections

**Verification Steps:**
1. Run crew manually
2. Verify Homelab Strategist reads context files
3. Verify output includes homelab-specific opportunities
4. Check token usage stays within budget (~$0.15 per run expected)

---

### Phase 2: Add Work Strategist Agent (60-90 min)

**Goal:** Create Work Strategist agent that evaluates signals against work context.

**Concrete Artifacts:**
1. Enhanced `crew.py` with Work Strategist agent definition
2. Work Strategist task definition
3. Enhanced context loader to read briefs and transcripts
4. Updated execution flow (Scout ‚Üí Analyst ‚Üí Both Strategists in parallel)
5. Test output demonstrating Work Strategist evaluation

**Context Files Read:**
- `/context/work_role.md` (currently empty - may need to populate)
- `/context/hot_topics.md` (has test data)
- `/context/briefs/*.md` (has test-project.md and phase-1-regression-test.md)
- `/context/transcripts/*.md` (has 2026-02-02-curl-test-meeting.md)

**Agent Specification:**
- **Model:** Sonnet 4.5
- **Role:** "Work Strategist"
- **Goal:** "Evaluate trend signals for relevance to Kyle's work projects, leadership priorities, and hot topics"
- **Input:** Analyst synthesis + work context files
- **Output:** Opportunity list with work relevance scores and specific connections to projects/priorities

**Verification Steps:**
1. Run crew manually
2. Verify Work Strategist reads all context file types
3. Verify output includes work-specific opportunities
4. Check token usage (~$0.15 per run expected)

---

### Phase 3: Slack Output Integration (45-60 min)

**Goal:** Format digest output for Slack and create posting mechanism.

**Concrete Artifacts:**
1. Slack formatter utility (`tools/slack_formatter.py`)
2. Updated `crew.py` to save Slack-formatted output
3. JSON output file for n8n consumption
4. Test Slack post (manual curl to webhook)

**Output Format:**
```
üìä Strategic Intelligence Digest - [Date]

üîç SCOUT SIGNALS
[Milestone/Movement/Noise breakdown]

üß† ANALYST SYNTHESIS
[Key patterns and implications]

üè† HOMELAB OPPORTUNITIES
[Homelab Strategist findings]

üíº WORK OPPORTUNITIES
[Work Strategist findings]

---
Generated by CrewAI Strategic Intelligence | [Timestamp]
```

**Slack Webhook Strategy:**
- Create new n8n workflow "Crew Output Handler"
- Webhook endpoint receives JSON with formatted digest
- Posts to `#trend-monitoring` channel
- Initially triggered manually via curl, then scheduled

**Verification Steps:**
1. Run crew, generate Slack-formatted output
2. Curl to n8n webhook (manual)
3. Verify message appears in Slack
4. Verify formatting renders correctly

---

### Phase 4: n8n Scheduled Execution (30-45 min)

**Goal:** Create daily scheduled trigger in n8n that runs crew and posts to Slack.

**Concrete Artifacts:**
1. n8n workflow "Strategic Intelligence Daily"
2. SSH Execute node configuration
3. Schedule trigger (daily 6 AM PT)
4. Error handling and logging

**Workflow Design:**
```
Schedule (6 AM daily)
  ‚Üì
SSH to 192.168.1.18
  ‚Üì
Execute: cd /opt/crewai && source venv/bin/activate && python3 crew.py
  ‚Üì
Read JSON output file
  ‚Üì
Post to Slack #trend-monitoring
  ‚Üì
Log execution (success/failure)
```

**n8n Configuration:**
- SSH connection to container 118 (root@192.168.1.18)
- Execution timeout: 10 minutes
- Retry on failure: 1 attempt after 5 min
- Error notification to Slack if failed

**Verification Steps:**
1. Import workflow to n8n
2. Test manual execution
3. Verify Slack post
4. Enable schedule
5. Monitor first scheduled run

---

### Phase 5: Context File Population (15-30 min)

**Goal:** Populate empty context files with baseline content so Strategists have meaningful data.

**Concrete Artifacts:**
1. `/context/homelab_architecture.md` - Brief summary of current homelab state
2. `/context/interest_areas.md` - Copy from roadmap's Interest Areas section
3. `/context/work_role.md` - Kyle's role description (provided by user or inferred)

**Content Strategy:**
- Homelab architecture: Reference existing system overview, distill to 1-2 paragraphs
- Interest areas: Copy directly from roadmap (already well-defined)
- Work role: Ask user for input or create placeholder

**Verification Steps:**
1. SSH to container, verify files exist and are readable
2. Run crew manually
3. Verify Strategists reference new content

---

## Risk Assessment

| Risk | Likelihood | Impact | Mitigation |
|------|------------|--------|------------|
| Token costs exceed budget | Medium | Medium | Monitor first week closely, adjust source count or agent frequency if needed |
| n8n SSH timeout during execution | Medium | Low | Set 10-minute timeout, add retry logic |
| Context files too large for token window | Low | Medium | Keep context files concise (<5k tokens each), summarize if needed |
| Strategists produce generic output | Medium | Medium | Iterate on prompts, provide specific examples in backstory |
| Slack formatting breaks on complex output | Low | Low | Test with various digest structures, use simple markdown |

---

## Execution Order

1. **Phase 5 first** (populate context files) - enables meaningful testing in Phases 1-2
2. **Phase 1** (Homelab Strategist) - single agent, easier to debug
3. **Phase 2** (Work Strategist) - parallel agent, reuses patterns from Phase 1
4. **Phase 3** (Slack output) - verify formatting before automation
5. **Phase 4** (n8n schedule) - final integration

---

## Success Criteria (from Roadmap)

- ‚úÖ n8n scheduled workflow triggers crew daily
- ‚úÖ Slack receives digest message
- ‚úÖ Strategists reference content from `/context/` files
- ‚úÖ Opportunities flagged when relevant to homelab or work context

**Evidence to Capture:**
- Screenshot of Slack digest post
- Log showing Strategist context file references
- Token usage log from first full run
- n8n workflow execution history

---

## Estimated Time

| Phase | Estimated Time |
|-------|----------------|
| Phase 5 (Context population) | 15-30 min |
| Phase 1 (Homelab Strategist) | 60-90 min |
| Phase 2 (Work Strategist) | 60-90 min |
| Phase 3 (Slack output) | 45-60 min |
| Phase 4 (n8n schedule) | 30-45 min |
| **Total** | **3.5 - 5 hours** |

---

## Open Questions

1. **Work role content:** Should user provide work role description, or should I infer from existing project briefs?
2. **Source refresh strategy:** Should Strategist agents get fresh source content, or only Scout/Analyst output?
3. **Digest frequency:** Roadmap says "daily" but should we start with manual triggers for first week to validate costs?
4. **Parallel vs. sequential Strategists:** Should both Strategists run in parallel (faster) or sequential (lower memory)?

**Recommendation:** Proceed with sequential for now (simpler debugging), can parallelize later if performance matters.

---

## Next Steps

**Awaiting User Approval:**
1. Review this plan
2. Provide work role description (or approve placeholder)
3. Confirm digest frequency (daily scheduled vs. manual for first week)
4. Approve execution start

Once approved, I will:
1. Create session note: `Session-2026-02-01-c-CrewAI-Criterion-4.md`
2. Begin Phase 5 (context population)
3. Proceed through phases sequentially
4. Log all changes in session note
5. Capture verification evidence
6. Update roadmap on completion

---

*Plan created: 2026-02-01 23:15 PST*
*Estimated completion: 2026-02-02 04:00 PST (assuming 4-hour session)*
